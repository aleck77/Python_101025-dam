import re

# Функция парсинга из агента create_chart
def parse_cost(cost_str):
    """Парсит строки вида '$36,700-41,200' → 38950.0 или '$7,200' → 7200"""
    numbers = re.findall(r'\d+(?:,\d+)*', cost_str.replace('$', ''))
    if not numbers:
        return 0
    nums = [int(n.replace(',', '')) for n in numbers]
    if len(nums) >= 2 and '-' in cost_str:
        return (nums[0] + nums[1]) / 2
    return nums[0]

# Полные сырые данные из create_chart вызовов

TCO_RAW_DATA = {
    "Статья расходов": [
        "Аренда/покупка сервера в месяц",
        "Лицензии ПО",
        "Электричество/охлаждение/сетевые услуги",
        "Администрирование (чел-часы)",
        "Резервное копирование",
        "Миграция/развертывание VM",
        "Высокая доступность/HA кластер",
        "ИТОГО в год",
        "ИТОГО за 3 года"
    ],
    "Dediki (год)": [
        "$600 x 12 = $7,200",
        "$0-2,000",
        "$2,000-3,000",
        "400 часов x $50 = $20,000",
        "$1,500-3,000",
        "$3,000-5,000",
        "$3,000-8,000",
        "$36,700-41,200",
        "$110,000-123,600"
    ],
    "Proxmox на сервере (год)": [
        "$400 x 12 = $4,800",
        "$0",
        "$1,200-1,800",
        "300 часов x $50 = $15,000",
        "$500 (Proxmox Backup Server)",
        "$500 (быстро через Proxmox)",
        "$400 (2 node кластер)",
        "$22,500-27,300",
        "$67,500-81,900"
    ]
}

COMPARISON_TABLE = {
    "Параметр": [
        "Архитектура", "Тип виртуализации", "Производительность", "Управление ресурсами",
        "Масштабируемость", "Стоимость (средняя)", "Требования к знаниям",
        "Время развертывания", "Высокая доступность", "Резервное копирование",
        "Безопасность", "Управляемость"
    ],
    "Dediki": [
        "Физический сервер (100% ресурсов)",
        "Нет встроенной виртуализации",
        "Максимальная, без потерь",
        "Полный контроль над всем железом",
        "Ограниченная, требует замены оборудования",
        "$49-180+ в месяц",
        "Высокие (полное администрирование)",
        "15-30 минут",
        "Нет встроенной",
        "Нужно настраивать самостоятельно",
        "Полный контроль, полная ответственность",
        "Веб-панель провайдера, CLI"
    ],
    "Proxmox": [
        "Гипервизор (KVM + LXC виртуализация)",
        "Встроенная двойная виртуализация",
        "Высокая, незначительные потери 5-10%",
        "Гибкое распределение между VM/контейнерами",
        "Высокая через кластеризацию и живую миграцию",
        "Бесплатное ПО, стоимость зависит от сервера",
        "Средние-высокие (виртуализация + Linux)",
        "15-30 минут + настройка VM",
        "Есть встроенная (HA кластеры)",
        "Интегрировано (Proxmox Backup Server)",
        "Изоляция VM, встроенный firewall",
        "Встроенный веб-интерфейс Proxmox"
    ]
}

# Полный экспорт всех данных
ALL_RAW_DATA = {
    "tco_analysis": TCO_RAW_DATA,
    "comparison_table": COMPARISON_TABLE,
    "recommendations_matrix": {
        "Тип проекта": [
            "Высоконагруженные веб-сайты", "Игровые серверы", "Корпоративная инфраструктура",
            "Стартап", "ML/обработка данных", "VPS хостинг для клиентов",
            "Тестирование/разработка", "Финансовые системы"
        ],
        "Dediki": [
            "✅ Отличный выбор", "✅ Рекомендуется", "⚠️ Условно", "❌ Нежелательно",
            "✅ Рекомендуется", "⚠️ Один уровень", "❌ Избыточно", "✅ Хороший выбор"
        ],
        "Proxmox": [
            "✅ Хороший выбор", "⚠️ Условно", "✅✅ Лучший выбор", "✅✅ Оптимально",
            "⚠️ С GPU passthrough", "✅✅ Идеален", "✅✅ Идеально", "✅ Возможен"
        ]
    }
}

print("✅ Все сырые данные загружены!")
print(f"TCO строк: {len(TCO_RAW_DATA['Статья расходов'])}")
